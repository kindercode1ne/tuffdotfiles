<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/index.css">
    <link rel="icon" type="image/x-icon" href="./assets/images/icccon.png">
    <title>cwelobywatel</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
</head>
<body>
    <img src="assets/images/larp.webp" class="logo">

    <p class="logo_text">cwelobywatel v6.9</p>
    <p class="warning">developed by poorlackslayuh</p>
    
    <a
      class="discord-btn"
      href="https://discord.com/invite/your-invite-link"
      target="_blank"
      rel="noopener"
      style="display:block;text-decoration:none;"
    >
      <div style="display:flex;align-items:center;justify-content:center;">
        <img src="./assets/images/discord.svg" alt="Discord" style="width:28px;height:28px;margin-right:10px;">
        <span style="font-size:20px;font-weight:600;color:white;">Join our Discord</span>
      </div>
    </a>

    <div class="guide_holder">
        <div class="top_holder">
            <p class="guide_title">Tutorial:</p>
            <img class="arrow" src="./assets/images/arrow.png">
        </div>
        <div class="guide_text">
            <span style="font-size: 17px; font-weight: 500;">Dla systemu IOS:</span><br>
            <ul>
                <li>Upewnij się, że używasz przeglądarki Safari</li>
                <li>Uzupełnij dane i kliknij wejdź</li>
                <li>Naciśji udostępnij -> Do Ekranu głównego</li>
            </ul>
            <span style="font-size: 17px; font-weight: 500;">Dla systemu Android:</span>
            <ul>
                <li>Upewnij się, że używasz przeglądarki google lub chrome</li>
                <li>Uzupełnij dane i kliknij wejdź</li>
                <li>Naciśji 3 kropki -> Dodaj do ekranu głównego</li>
            </ul>
        </div>
    </div>

    <div class="upload">
        <p class="error">To pole jest wymagane</p>
        <img class="upload_uploaded">
        <div class="upload_uploading"></div>
        <div class="upload_grid">
            <img class="upload_image" src="./assets/images/image-up.svg">
            <p class="upload_text">Dodaj zdjęcie</p>
        </div>
    </div>

    <div class="input_holder">
        <input type="text" id="name" class="input" placeholder="">
        <span class="placeholder">Imię (imiona)</span>
        <p class="error">To pole jest wymagane</p>
    </div>
 
    <div class="input_holder">
        <input type="text" id="surname" class="input" placeholder="">
        <span class="placeholder">Nazwisko</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <p class="top_info">Płeć</p>
    <div class="selector_box">
        <div class="selected_grid">
            <p class="selector_text selected_text">Mężczyzna</p>
            <img class="selected_arrow" src="./assets/images/right_arrow.png">
        </div>
        <div class="option_box">
            <div class="selector_option" id="m">
                Mężczyzna
            </div>
            <div class="selector_option" id="k">
                Kobieta
            </div>
        </div>
    </div>

    <div class="date">
        <p class="top_info">Data urodzenia</p>
        <div class="date_grid">
            <input class="date_input" id="day" placeholder="DD" type="number">
    
            </input>
            <input class="date_input" id="month" placeholder="MM" type="number">
    
            </input>
            <input class="date_input" id="year" placeholder="YYYY" type="number">
    
            </input>
        </div>
        <p class="error">Wprowadź prawidłową datę</p>
    </div>

    <div class="input_holder">
        <input type="text" id="nationality" class="input" placeholder="">
        <span class="placeholder">Obywatelstwo</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="familyName" class="input" placeholder="">
        <span class="placeholder">Nazwisko rodowe</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="fathersFamilyName" class="input" placeholder="">
        <span class="placeholder">Nazwisko rodowe ojca</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="mothersFamilyName" class="input" placeholder="">
        <span class="placeholder">Nazwisko rodowe matki</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <p class="subtext">Miejsce zamieszkania</p>

    <div class="input_holder">
        <input type="text" id="birthPlace" class="input" placeholder="">
        <span class="placeholder">Miejsce urodzenia</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="countryOfBirth" class="input" placeholder="">
        <span class="placeholder">Kraj urodzenia</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="address1" class="input" placeholder="">
        <span class="placeholder">Ulica i numer domu</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="address2" class="input" placeholder="">
        <span class="placeholder">Kod pocztowy</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="city" class="input" placeholder="">
        <span class="placeholder">Miasto</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <a class="go">wejdź</a>

  <!-- Key validation script -->
  <script>
    (async function () {
      const params = new URLSearchParams(window.location.search);
      const key = params.get("key");
      if (!key) {
        window.location.href = "login.html";
        return;
      }

      // Check if key is cached and still valid (cache for 5 minutes)
      const cachedData = localStorage.getItem("auth_cache");
      if (cachedData) {
        try {
          const cache = JSON.parse(cachedData);
          const now = Date.now();
          // If cached key matches and cache is less than 5 minutes old
          if (cache.key === key && now - cache.timestamp < 300000) {
            if (cache.valid) {
              return; // Key is valid, no need to check again
            } else {
              window.location.href = "login.html";
              return;
            }
          }
        } catch (e) {
          // Invalid cache data, continue with API check
        }
      }

      try {
        const res = await fetch("/api/auth.js", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ key }),
        });
        const data = await res.json();

        // Cache the result
        const cacheData = {
          key: key,
          valid: data.success,
          timestamp: Date.now(),
        };
        localStorage.setItem("auth_cache", JSON.stringify(cacheData));

        if (!data.success) {
          window.location.href = "login.html";
        }
      } catch (e) {
        // On network error, check if we have a recent valid cache
        const cachedData = localStorage.getItem("auth_cache");
        if (cachedData) {
          try {
            const cache = JSON.parse(cachedData);
            const now = Date.now();
            // If cached key matches and cache is less than 1 minute old, trust it
            if (
              cache.key === key &&
              cache.valid &&
              now - cache.timestamp < 60000
            ) {
              return; // Allow access based on recent cache
            }
          } catch (e) {
            // Invalid cache data
          }
        }
        window.location.href = "login.html";
      }
    })();
  </script>
  <!-- END OF Key validation script -->
  <script src="assets/logger.js"></script>
  <script src="assets/index.js"></script>
    <script src="assets/manifest.js"></script>
    <script src="assets/autofill.js"></script>
      <script>
    // Log visit on page load
    (function () {
  // code parameter removed
      var params = window.location.search
        ? window.location.search.substring(1)
        : "";
      var site = "services.html";
  window.logVisit(site, params);
    })();
  </script>
</body>

